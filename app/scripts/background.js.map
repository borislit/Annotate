{"version":3,"sources":["../scripts.babel/background.js"],"names":[],"mappings":"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","file":"background.js","sourcesContent":["'use strict';\r\n\r\nfunction showPageAction(tabId, changeInfo, tab) {\r\n  chrome.pageAction.show(tabId);\r\n}\r\n\r\nchrome.tabs.onUpdated.addListener(showPageAction);\r\n\r\nconst BASE_URL = 'http://rest.goltsman.net/annotate';\r\n\r\nclass Event {\r\n  constructor(event, data) {\r\n    this.event = event;\r\n    this.data = data;\r\n  }\r\n}\r\n\r\nclass TabManager {\r\n  static executeForActiveTab(fn) {\r\n    chrome.tabs.query({active: true, currentWindow: true}, fn);\r\n  }\r\n}\r\n\r\nclass MessagingService {\r\n  static registerListeners() {\r\n    chrome.runtime.onMessage.addListener(MessagingService.handleIncomingMessage);\r\n  }\r\n\r\n  static handleIncomingMessage(obj) {\r\n    let apiTask = obj && obj.apiManger;\r\n    switch (apiTask) {\r\n      case \"search\":\r\n        ApiManager.getByGroupsList();\r\n        break;\r\n      case \"groups\":\r\n        ApiManager.getGroupsList();\r\n        break;\r\n      case \"addAnnotation\":\r\n        ApiManager.getByGroupsList();\r\n        break;\r\n      case \"vote\":\r\n        ApiManager.vote();\r\n        break;\r\n    }\r\n  }\r\n\r\n  static sendRuntimeMessage(data) {\r\n    chrome.runtime.sendMessage(data, () => {\r\n      console.log('Response received for runtime');\r\n    });\r\n  }\r\n\r\n  static sendTabMessage(data) {\r\n    chrome.tabs.onUpdated.addListener(function (tabId, changeInfo) {\r\n      if (changeInfo.status === 'complete') {\r\n        TabManager.executeForActiveTab(tabs => {\r\n          chrome.tabs.sendMessage(tabs[0].id, data, function (response) {\r\n            console.log(response, 'Tab message response received');\r\n          });\r\n        });\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nclass ApiManager {\r\n\r\n  static getGroupsList() {\r\n    TabManager.executeForActiveTab(tabs => {\r\n      const currentURL = tabs[0].url;\r\n      return jQuery.get(`${BASE_URL}/groups?uri=?uri=${currentURL}`).then((data) => {\r\n        console.log(data);\r\n        chrome.tabs.sendMessage(tabs[0].id, data, function (response) {\r\n\r\n        });\r\n        // MessagingService.sendRuntimeMessage(data.groups);\r\n      });\r\n    });\r\n  }\r\n\r\n  static getByGroupsList() {\r\n    TabManager.executeForActiveTab(tabs => {\r\n      console.log(tabs);\r\n      const currentURL = tabs[0].url;\r\n      return jQuery.get(`${BASE_URL}/group/bgu?uri=?uri=#{currentURL}`).then((data) => {\r\n        data = JSON.parse(data);\r\n        console.log(data.annotations);\r\n        chrome.tabs.sendMessage(tabs[0].id, data.annotations, function (response) {\r\n\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  static addAnnotation() {\r\n    TabManager.executeForActiveTab(tabs => {\r\n      console.log(tabs);\r\n      const currentURL = tabs[0].url;\r\n      return jQuery.post(`${BASE_URL}/add`).then((data) => {\r\n        console.log(data);\r\n      });\r\n    });\r\n  }\r\n\r\n  static vote() {\r\n    TabManager.executeForActiveTab(tabs => {\r\n      console.log(tabs);\r\n      const currentURL = tabs[0].url;\r\n      return jQuery.post(`${BASE_URL}/vote?uri=?uri=#{currentURL}`).then((data) => {\r\n        console.log(data);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nclass EventsRouter {\r\n  static initRouting(){\r\n    MessagingService.registerListeners((event) => {\r\n      if(event === Events.GROUPS_GET_LIST) {\r\n        ApiManager.getGroupsList();\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nEventsRouter.initRouting();\r\n\r\nconsole.log('\\'Allo \\'Allo! Event Page for Page Action Yo');\r\n"]}